<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ãƒ•ãƒ¤ã‚»ãƒ«äºˆç´„ç®¡ç†ï¼†ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* --- åŸºæœ¬è¨­å®š --- */
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans JP", sans-serif; background: #f5f7fb; padding: 20px; }

    /* --- ä¸Šéƒ¨ï¼šäºˆç´„ãƒªã‚¹ãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ« --- */
    .list-container { max-width: 800px; margin: 0 auto 30px auto; background: #fff; padding: 20px; border-radius: 14px; box-shadow: 0 8px 20px rgba(0,0,0,.08); }

    /* â–¼â–¼â–¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨ã‚¹ã‚¿ã‚¤ãƒ« â–¼â–¼â–¼ */
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: bold; color: #333; font-size: 1.1em; }
    .calendar-nav-btn { background: #f0f2f5; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-weight: bold; color: #555; }
    .calendar-nav-btn:hover { background: #e4e6eb; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 15px; }
    .cal-cell { aspect-ratio: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 8px; cursor: pointer; font-size: 14px; color: #333; position: relative; background: #fff; border: 1px solid transparent; }
    .cal-cell:hover { filter: brightness(0.95); }
    .cal-sat { background-color: #eff6ff; color: #1e40af; }
    .cal-sun { background-color: #fef2f2; color: #991b1b; }
    .cal-head { font-size: 12px; color: #888; font-weight: normal; cursor: default; background:none !important;}
    .cal-today { border: 2px solid #2563eb; font-weight: bold; }
    .cal-selected { background-color: #2563eb !important; color: #fff !important; border-color: #2563eb; }
    .cal-has-event::after { content: ""; position: absolute; bottom: 4px; width: 5px; height: 5px; border-radius: 50%; background-color: #ef4444; }
    .cal-selected.cal-has-event::after { background-color: #fff; }

    .controls-area { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
    .btn-sub { padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; background: #fff; color: #555; font-size: 13px; cursor: pointer; }
    #btnTodayReset { background-color: #dcfce7; color: #14532d; border: 1px solid #86efac; font-weight: bold; }
    #btnTodayReset:hover { background-color: #bbf7d0; }
    
    /* â˜…Meetç™ºè¡Œãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
    #btnGenerateMeet {
        background-color: #e0e7ff; color: #3730a3; border: 1px solid #c7d2fe; font-weight: bold;
        display: flex; align-items: center; gap: 4px;
    }
    #btnGenerateMeet:hover { background-color: #c7d2fe; }

    .search-area { margin-bottom: 10px; }
    .search-area input { margin-top: 0; }
    .table-wrapper { max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; white-space: nowrap; font-size: 13px; }
    th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
    th { background-color: #f8f9fa; position: sticky; top: 0; z-index: 1; }
    tr.clickable { cursor: pointer; transition: background 0.1s; }
    tr.clickable:hover { background-color: #e3f2fd; }
    tr.selected { background-color: #bbdefb; border-left: 5px solid #2563eb; }
    tr.highlight-next { background-color: #fef9c3 !important; border-left: 5px solid #eab308; }
    tr.highlight-next.selected { background-color: #bbdefb !important; border-left: 5px solid #2563eb; }

    /* --- ä¸‹éƒ¨ï¼šç”Ÿæˆãƒ„ãƒ¼ãƒ«ç”¨ã‚¹ã‚¿ã‚¤ãƒ« --- */
    .box { max-width: 520px; margin: auto; background: #fff; padding: 20px; border-radius: 14px; box-shadow: 0 8px 20px rgba(0,0,0,.08); }
    h1 { font-size: 18px; margin: 0 0 16px; }
    h2 { font-size: 16px; margin: 0 0 10px; color: #555; border-bottom: 1px solid #eee; padding-bottom: 8px;}
    label { display: block; margin-top: 12px; font-size: 13px; color: #555; }
    input, select, button, textarea { width: 100%; padding: 10px; margin-top: 6px; font-size: 15px; border-radius: 10px; border: 1px solid #d7dbe6; background: #fff; }
    .dateWrap { position: relative; }
    input[type="date"] { padding-right: 12px; }
    .btnRow { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 14px; }
    button { border: none; cursor: pointer; font-weight: 800; background: #2563eb; color: #fff; }
    button.secondary { background: #111827; }
    button:hover { opacity: .92; }
    .mini { margin-top: 10px; font-size: 12px; color: #667085; }
    textarea { height: 260px; margin-top: 12px; font-size: 14px; line-height: 1.6; font-family: monospace; white-space: pre-wrap; }
    .status { margin-top: 8px; font-size: 12px; color: #0f766e; min-height: 16px; }
  </style>
</head>
<body>

  <div class="list-container">
    <h2>ğŸ“… äºˆç´„ãƒªã‚¹ãƒˆã‹ã‚‰é¸æŠ</h2>
    
    <div class="calendar-header">
        <button class="calendar-nav-btn" id="prevMonthBtn">ï¼œ</button>
        <span id="calendarTitle">2026å¹´ 1æœˆ</span>
        <button class="calendar-nav-btn" id="nextMonthBtn">ï¼</button>
    </div>
    <div class="calendar-grid" id="calendarGrid"></div>
    
    <div class="controls-area">
        <button class="btn-sub" id="btnTodayReset">ä»Šæ—¥ã«æˆ»ã‚‹</button>
        <button class="btn-sub" id="btnShowAll">ãƒªã‚¹ãƒˆã‚’å…¨ã¦è¡¨ç¤º</button>
        <button class="btn-sub" id="btnGenerateMeet">âš¡ Meetãƒªãƒ³ã‚¯ä¸€æ‹¬ç™ºè¡Œ</button>
    </div>

    <div class="search-area">
      <input type="text" id="searchInput" placeholder="åå‰ã§æ¤œç´¢...">
    </div>
    
    <div id="loading" style="font-size:12px; color:#666;">èª­ã¿è¾¼ã¿ä¸­...</div>

    <div class="table-wrapper">
      <table id="customerTable" style="display:none;">
        <thead>
          <tr>
            <th>æ¥åº—æ—¥</th>
            <th>æ™‚é–“</th>
            <th>ãŠåå‰</th>
            <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          </tbody>
      </table>
    </div>
  </div>


  <div class="box" id="toolBox">
    <h1>ğŸ—“ é¢è«‡ãƒ¡ãƒ¢ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
    <label>æ—¥ä»˜ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‰</label>
    <div class="dateWrap"><input type="date" id="date"></div>
    <label>é–‹å§‹æ™‚é–“ï¼ˆ10ã€œ17æ™‚ï¼‰</label>
    <select id="time"></select>
    <label>é¢è«‡æ–¹æ³•</label>
    <select id="method">
      <option>Google Meet</option>
      <option>é›»è©±</option>
      <option>LINE</option>
      <option>ãƒ¡ãƒ¼ãƒ«</option>
    </select>
    <div class="btnRow">
      <button id="copyAllBtn">å…¨æ–‡ã‚³ãƒ”ãƒ¼ï¼ˆé€ä¿¡ç”¨ï¼‰</button>
      <button class="secondary" id="copyDateBtn">æ—¥æ™‚ã ã‘ã‚³ãƒ”ãƒ¼</button>
    </div>
    <div class="status" id="status"></div>
    <div class="mini">ä¸‹ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ï¼ˆãã®ã¾ã¾è²¼ã‚Šä»˜ã‘OKï¼‰</div>
    <textarea id="preview" readonly></textarea>
  </div>

<script>
(() => {
  // --- 1. ãƒ„ãƒ¼ãƒ«ãƒ­ã‚¸ãƒƒã‚¯ ---
  const week = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
  const LINE = "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€";

  const dateEl = document.getElementById("date");
  const timeEl = document.getElementById("time");
  const methodEl = document.getElementById("method");
  const previewEl = document.getElementById("preview");
  const statusEl = document.getElementById("status");
  const copyAllBtn = document.getElementById("copyAllBtn");
  const copyDateBtn = document.getElementById("copyDateBtn");

  function buildTimes() {
    timeEl.innerHTML = "";
    for (let h = 5; h <= 23; h++) {
      const opt = document.createElement("option");
      opt.value = String(h);
      opt.textContent = `${h}æ™‚ï½é¢è«‡é–‹å§‹`;
      if(h === 10) opt.selected = true;
      timeEl.appendChild(opt);
    }
  }

  function setToday() {
    const t = new Date();
    const yyyy = t.getFullYear();
    const mm = String(t.getMonth()+1).padStart(2,"0");
    const dd = String(t.getDate()).padStart(2,"0");
    dateEl.value = `${yyyy}-${mm}-${dd}`;
  }

  function fmtDateParts() {
    const v = dateEl.value;
    if (!v) return null;
    const d = new Date(v + "T00:00:00");
    const y = d.getFullYear();
    const m = d.getMonth() + 1;
    const day = d.getDate();
    const dow = week[d.getDay()];
    const h = Number(timeEl.value || 10);
    const method = methodEl.value;
    return { y, m, day, dow, h, method };
  }

  function buildDateBox() {
    const p = fmtDateParts();
    if (!p) return "";
    return `${LINE}
é¢è«‡äºˆç´„æ—¥æ™‚
${p.y}å¹´${p.m}æœˆ${p.day}æ—¥ï¼ˆ${p.dow}ï¼‰
${p.h}æ™‚ï½é¢è«‡é–‹å§‹
æ–¹æ³•ï¼š${p.method}
${LINE}`;
  }

  function buildFullMessage() {
    const p = fmtDateParts();
    if (!p) return "";
    const dateBox = buildDateBox();
    return `ãƒ•ãƒ¤ã‚»ãƒ«ã‚µãƒãƒ¼ãƒˆã§ã™ã€‚
ã”é€£çµ¡ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

${dateBox}

ã”æŒ‡å®šã®ãŠæ™‚é–“ã«
ç©ºãæ ãŒã”ã–ã„ã¾ã—ãŸã®ã§
ä¸Šè¨˜æ—¥ç¨‹ã«ã¦é¢è«‡ã«
å…¥ã‚‰ã›ã¦ã„ãŸã ãã¾ã™ã€‚

é¢è«‡ã®éš›ã«ã¯

ã€Œãƒ•ãƒ¤ã‚»ãƒ«AIã®æº–å‚™ã€
ã€ŒèããŸã„ã“ã¨ã€
ã€Œã‚µãƒãƒ¼ãƒˆã‚’å—ã‘ãŸã„ã“ã¨ã€

ã“ã¡ã‚‰ã‚’ã”ç”¨æ„ãƒ»ã”æº–å‚™ã®ã†ãˆ
ã”å‚åŠ ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

ãã®é–“ã§ã‚‚
ã”è³ªå•ãªã©ãŒã”ã–ã„ã¾ã—ãŸã‚‰

ã—ã£ã‹ã‚Šä¸å¯§ã«ã‚µãƒãƒ¼ãƒˆå¯¾å¿œã‚’
ã•ã›ã¦ã„ãŸã ãã¾ã™ã®ã§

ã”ä¸æ˜ç‚¹ãŒã”ã–ã„ã¾ã™å ´åˆã¯
ãŠå•ã„åˆã‚ã›ãã ã•ã„ã¾ã›ã€‚

ä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚`;
  }

  function renderPreview() {
    const text = buildFullMessage();
    previewEl.value = text || "æ—¥ä»˜ã‚’é¸ã¶ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå‡ºã¾ã™";
    statusEl.textContent = "";
  }

  async function copyText(text, okMsg) {
    if (!text) {
      statusEl.textContent = "æ—¥ä»˜ã‚’é¸ã‚“ã§ãã ã•ã„";
      statusEl.style.color = "#b45309";
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      statusEl.textContent = okMsg;
      statusEl.style.color = "#0f766e";
    } catch {
      previewEl.focus();
      previewEl.select();
      document.execCommand("copy");
      statusEl.textContent = okMsg + "ï¼ˆäº’æ›ã‚³ãƒ”ãƒ¼ï¼‰";
      statusEl.style.color = "#0f766e";
    }
    setTimeout(() => statusEl.textContent = "", 1500);
  }

  dateEl.addEventListener("change", renderPreview);
  timeEl.addEventListener("change", renderPreview);
  methodEl.addEventListener("change", renderPreview);
  copyAllBtn.addEventListener("click", () => copyText(buildFullMessage(), "å…¨æ–‡ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));
  copyDateBtn.addEventListener("click", () => copyText(buildDateBox(), "æ—¥æ™‚ã ã‘ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));
  buildTimes();
  setToday();
  renderPreview();


  // --- 2. äºˆç´„ãƒªã‚¹ãƒˆé€£æºæ©Ÿèƒ½ ---
  
  // â˜…â˜…â˜… ã“ã‚ŒãŒã‚ãªãŸã®æ–°ã—ã„APIã®URLã§ã™ï¼ â˜…â˜…â˜…
  const API_URL = "https://script.google.com/macros/s/AKfycbxd654xuOqmP7xbMh5_gW3t0NxlYHtLiXi0Xhn4ojz0MYtBf24qiTVwvBXG4seHDPnY/exec";
  
  let allData = [];
  let calDate = new Date(); 
  let currentSelectedDateStr = "";

  function safeDateStr(str) {
    if(!str) return "";
    const match = str.match(/(\d{4})[\.\/\-](\d{1,2})[\.\/\-](\d{1,2})/);
    if(match) return `${match[1]}-${match[2]}-${match[3]}`; 
    return "";
  }

  const holidays = [
    "2025-01-01","2025-01-13","2025-02-11","2025-02-23","2025-02-24","2025-03-20","2025-04-29",
    "2025-05-03","2025-05-04","2025-05-05","2025-05-06","2025-07-21","2025-08-11","2025-09-15",
    "2025-09-23","2025-10-13","2025-11-03","2025-11-23","2025-11-24",
    "2026-01-01","2026-01-12","2026-02-11","2026-02-23","2026-03-21","2026-04-29",
    "2026-05-03","2026-05-04","2026-05-05","2026-05-06","2026-07-20","2026-08-11","2026-09-21",
    "2026-09-23","2026-10-12","2026-11-03","2026-11-23"
  ];
  function isHoliday(y, m, d) {
    const s = `${y}-${('0'+m).slice(-2)}-${('0'+d).slice(-2)}`;
    return holidays.includes(s);
  }

  function renderCalendar() {
    const grid = document.getElementById('calendarGrid');
    grid.innerHTML = "";
    const weekNames = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
    weekNames.forEach(w => {
        const div = document.createElement('div');
        div.className = "cal-cell cal-head";
        div.textContent = w;
        if(w==="æ—¥") div.style.color = "#ef4444";
        if(w==="åœŸ") div.style.color = "#3b82f6";
        grid.appendChild(div);
    });
    const year = calDate.getFullYear();
    const month = calDate.getMonth();
    document.getElementById('calendarTitle').textContent = `${year}å¹´ ${month+1}æœˆ`;
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    
    for(let i=0; i<firstDay.getDay(); i++) {
        const div = document.createElement('div');
        div.className = "cal-cell";
        grid.appendChild(div);
    }
    for(let d=1; d<=lastDay.getDate(); d++) {
        const div = document.createElement('div');
        div.className = "cal-cell";
        div.textContent = d;
        const mm = ('0'+(month+1)).slice(-2);
        const dd = ('0'+d).slice(-2);
        const targetStr = `${year}.${mm}.${dd}`;
        const checkDate = new Date(year, month, d);
        const dayOfWeek = checkDate.getDay();
        
        if(dayOfWeek === 6) div.classList.add("cal-sat");
        else if(dayOfWeek === 0 || isHoliday(year, month+1, d)) div.classList.add("cal-sun");
        const today = new Date();
        if(year===today.getFullYear() && month===today.getMonth() && d===today.getDate()) {
            div.classList.add("cal-today");
        }
        const hasEvent = allData.some(row => row[2] && row[2].includes(targetStr));
        if(hasEvent) div.classList.add("cal-has-event");
        if(targetStr === currentSelectedDateStr) div.classList.add("cal-selected");

        div.onclick = () => {
            currentSelectedDateStr = targetStr;
            renderCalendar();
            filterListByDate(targetStr);
        };
        grid.appendChild(div);
    }
  }

  document.getElementById('prevMonthBtn').onclick = () => { calDate.setMonth(calDate.getMonth() - 1); renderCalendar(); };
  document.getElementById('nextMonthBtn').onclick = () => { calDate.setMonth(calDate.getMonth() + 1); renderCalendar(); };
  document.getElementById('btnTodayReset').onclick = () => {
    calDate = new Date();
    const y = calDate.getFullYear();
    const m = ('0'+(calDate.getMonth()+1)).slice(-2);
    const d = ('0'+calDate.getDate()).slice(-2);
    const todayStr = `${y}.${m}.${d}`;
    currentSelectedDateStr = todayStr;
    renderCalendar();
    filterListByDate(todayStr);
  };
  document.getElementById('btnShowAll').onclick = () => {
    currentSelectedDateStr = "";
    renderCalendar();
    renderList(sortDataByTime(allData));
  };

  // â˜…æ–°æ©Ÿèƒ½ï¼šMeetãƒªãƒ³ã‚¯ä¸€æ‹¬ç™ºè¡Œ
  document.getElementById('btnGenerateMeet').onclick = async () => {
    if(!confirm("æœªç™ºè¡Œã®äºˆç´„ã«å¯¾ã—ã¦ã€Google Meetãƒªãƒ³ã‚¯ã‚’ä¸€æ‹¬ç™ºè¡Œã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚‚ç™»éŒ²ã•ã‚Œã¾ã™ï¼‰")) return;
    
    const btn = document.getElementById('btnGenerateMeet');
    const originalText = btn.textContent;
    btn.textContent = "ç™ºè¡Œä¸­...";
    btn.disabled = true;

    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({ action: "generateLinks" })
        });
        const result = await response.json();
        
        alert(result.message); // çµæœã‚’è¡¨ç¤º
        
        loadData(); // ãƒªãƒ­ãƒ¼ãƒ‰

    } catch(e) {
        alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + e.message);
    } finally {
        btn.textContent = originalText;
        btn.disabled = false;
    }
  };

  function loadData() {
    document.getElementById('loading').style.display = 'block';
    fetch(API_URL)
      .then(res => res.json())
      .then(data => {
        allData = data;
        if (currentSelectedDateStr) {
            filterListByDate(currentSelectedDateStr);
        } else {
            renderList(sortDataByTime(allData));
        }
        renderCalendar();
        document.getElementById('loading').style.display = 'none';
        document.getElementById('customerTable').style.display = 'table';
      })
      .catch(err => {
          console.error(err);
          document.getElementById('loading').textContent = "èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼";
      });
  }
  loadData();

  function sortDataByTime(dataList) {
    return dataList.sort((a, b) => {
        const timeA = a[3] || "99:99"; 
        const timeB = b[3] || "99:99";
        return timeA.localeCompare(timeB);
    });
  }
  function isExpired(dateStr, timeStr) {
    if(!timeStr) return false;
    const ymd = safeDateStr(dateStr); 
    if(!ymd) return false;
    const targetDate = new Date(`${ymd}T${timeStr}:00`);
    if(isNaN(targetDate.getTime())) return false;
    targetDate.setHours(targetDate.getHours() + 2);
    return new Date() > targetDate;
  }
  function filterListByDate(targetDateStr) {
    let filtered = allData.filter(row => row[2] && row[2].includes(targetDateStr));
    filtered = filtered.filter(row => {
        const dStr = row[2];
        const tStr = row[3];
        if (isExpired(dStr, tStr)) return false; 
        return true;
    });
    const sorted = sortDataByTime(filtered);
    renderList(sorted, true); 
  }

  function renderList(data, isFilteredByDate = false) {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = "";
    if(data.length === 0) {
      tbody.innerHTML = "<tr><td colspan='4' style='text-align:center; color:#999; padding:20px;'>äºˆç´„ãªã—</td></tr>";
      return;
    }
    
    const today = new Date();
    const y = today.getFullYear();
    const m = ('0'+(today.getMonth()+1)).slice(-2);
    const d = ('0'+today.getDate()).slice(-2);
    const todayStr = `${y}.${m}.${d}`;
    const shouldHighlight = isFilteredByDate && (currentSelectedDateStr === todayStr);

    let targetHighlightTime = null;
    if (shouldHighlight) {
        const now = new Date();
        const nextAppt = data.find(row => {
            const tStr = row[3]; 
            if(!tStr) return false;
            const parts = tStr.split(":");
            const h = parseInt(parts[0]);
            const min = parseInt(parts[1] || 0);
            const apptDate = new Date();
            apptDate.setHours(h, min, 0, 0);
            return apptDate > now;
        });
        if(nextAppt) { targetHighlightTime = nextAppt[3]; }
    }

    data.forEach((row) => {
      const dStr = row[2];
      const tStr = row[3];
      const name = row[12] || row[6] || "åç§°ãªã—";
      const status = row[5];
      const tr = document.createElement('tr');
      tr.className = "clickable";
      
      if(shouldHighlight && targetHighlightTime && tStr === targetHighlightTime) {
          tr.classList.add("highlight-next");
      }
      tr.innerHTML = `<td>${dStr}</td><td>${tStr}</td><td style="font-weight:bold">${name}</td><td>${status}</td>`;
      
      tr.onclick = () => {
        document.querySelectorAll('tr').forEach(t => t.classList.remove('selected'));
        tr.classList.add('selected');
        if(dStr) {
           const cleanDate = safeDateStr(dStr);
           if(cleanDate) dateEl.value = cleanDate;
        }
        if(tStr) {
           const hour = parseInt(tStr);
           if(hour) timeEl.value = String(hour);
        }
        renderPreview();
        if(window.innerWidth < 600) {
            document.getElementById('toolBox').scrollIntoView({behavior: "smooth"});
        }
      };
      tbody.appendChild(tr);
    });
  }
  
  document.getElementById('searchInput').onkeyup = (e) => {
    currentSelectedDateStr = "";
    renderCalendar();
    const val = e.target.value.toLowerCase();
    const filtered = allData.filter(row => row.join(" ").toLowerCase().includes(val));
    renderList(sortDataByTime(filtered));
  };

})();
</script>
</body>
</html>
