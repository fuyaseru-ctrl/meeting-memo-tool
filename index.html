<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ãƒ•ãƒ¤ã‚»ãƒ«é¡§å®¢ç®¡ç†ï¼†ä½œæˆãƒ„ãƒ¼ãƒ«</title>
<style>
  /* å…¨ä½“ã®åŸºæœ¬è¨­å®š */
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background-color: #f5f7fb;
    color: #333;
    padding: 20px;
    margin: 0;
  }
  .container { max-width: 1000px; margin: 0 auto; }

  /* å…±é€šã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
  .card {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    margin-bottom: 20px;
  }

  h2 { margin-top: 0; font-size: 18px; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; }

  /* --- ä¸Šéƒ¨ï¼šæ¤œç´¢ï¼†ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ --- */
  .filter-area {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }
  input[type="text"] {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 16px;
  }
  .btn-filter {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    background: #e0e0e0;
    color: #555;
  }
  .btn-filter.active { background: #1565c0; color: #fff; }

  /* --- ä¸­éƒ¨ï¼šãƒªã‚¹ãƒˆè¡¨ç¤º --- */
  .table-wrapper {
    max-height: 300px; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ */
    overflow-y: auto;
    border: 1px solid #eee;
  }
  table { width: 100%; border-collapse: collapse; white-space: nowrap; }
  th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; font-size: 14px; }
  th { background-color: #f8f9fa; position: sticky; top: 0; }
  /* ã‚¯ãƒªãƒƒã‚¯ã§ãã‚‹è¡Œã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
  tr.clickable { cursor: pointer; transition: background 0.2s; }
  tr.clickable:hover { background-color: #e3f2fd; }
  tr.selected { background-color: #bbdefb; border-left: 5px solid #1976d2; }

  /* --- ä¸‹éƒ¨ï¼šä½œæˆãƒ„ãƒ¼ãƒ«ï¼ˆå¾©æ´»ï¼‰ --- */
  label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; }
  input, select, textarea {
    width: 100%; padding: 10px; margin-top: 5px;
    border: 1px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box;
  }
  .btn-area { display: flex; gap: 10px; margin-top: 20px; }
  .btn-copy {
    flex: 1; padding: 12px; border: none; border-radius: 8px;
    color: #fff; font-weight: bold; cursor: pointer; font-size: 16px;
  }
  .btn-blue { background-color: #2563eb; }
  .btn-dark { background-color: #1e293b; }
  .btn-copy:active { opacity: 0.8; transform: translateY(2px); }
  
  /* ã‚¹ãƒãƒ›èª¿æ•´ */
  @media (max-width: 600px) {
    .filter-area { flex-direction: column; }
    .btn-area { flex-direction: column; }
  }
</style>
</head>
<body>

<div class="container">

  <div class="card">
    <div class="filter-area">
      <button class="btn-filter active" id="btnToday" onclick="filterData('today')">ä»Šæ—¥ã®ã¿</button>
      <button class="btn-filter" id="btnAll" onclick="filterData('all')">å…¨ã¦è¡¨ç¤º</button>
      <input type="text" id="searchInput" placeholder="åå‰ã§æ¤œç´¢..." onkeyup="searchData()">
    </div>
    
    <div id="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
    
    <div class="table-wrapper">
      <table id="customerTable" style="display:none;">
        <thead>
          <tr>
            <th>æ¥åº—æ—¥</th>
            <th>æ™‚é–“</th>
            <th>ãŠåå‰</th>
            <th>æ‹…å½“</th>
            <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          </tbody>
      </table>
    </div>
    <p style="font-size:12px; color:#666; text-align:right;">â€»è¡Œã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã«å…¥åŠ›ã•ã‚Œã¾ã™</p>
  </div>

  <div class="card" id="toolArea">
    <h2>ğŸ“ é¢è«‡ãƒ¡ãƒ¢ãƒ»ãƒ¡ãƒ¼ãƒ«ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h2>
    
    <label>æ—¥ä»˜</label>
    <input type="text" id="inputDate" placeholder="ä¾‹: 2026å¹´1æœˆ14æ—¥ (æ°´)">
    
    <label>é–‹å§‹æ™‚é–“</label>
    <select id="inputTime">
      <option value="10:00">10:00</option>
      <option value="11:00">11:00</option>
      <option value="12:00">12:00</option>
      <option value="13:00">13:00</option>
      <option value="14:00">14:00</option>
      <option value="15:00">15:00</option>
      <option value="16:00">16:00</option>
      <option value="17:00">17:00</option>
      <option value="18:00">18:00</option>
      <option value="19:00">19:00</option>
      <option value="20:00">20:00</option>
      <option value="21:00">21:00</option>
      <option value="22:00">22:00</option>
    </select>
    
    <label>é¢è«‡æ–¹æ³•</label>
    <select id="inputMethod" onchange="updatePreview()">
      <option value="Google Meet">Google Meet</option>
      <option value="Zoom">Zoom</option>
      <option value="é›»è©±">é›»è©±</option>
      <option value="æ¥åº—">æ¥åº—</option>
    </select>

    <div class="btn-area">
      <button class="btn-copy btn-blue" onclick="copyFull()">å…¨æ–‡ã‚³ãƒ”ãƒ¼ (é€ä¿¡ç”¨)</button>
      <button class="btn-copy btn-dark" onclick="copyDateOnly()">æ—¥æ™‚ã ã‘ã‚³ãƒ”ãƒ¼</button>
    </div>

    <label>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (è‡ªå‹•æ›´æ–°)</label>
    <textarea id="previewBox" rows="8" readonly></textarea>
  </div>

</div>

<script>
  // â˜…ã“ã“ã«Apps Scriptã®URLï¼ˆå¤‰æ›´ãªã—ï¼‰
  const API_URL = "https://script.google.com/macros/s/AKfycbzUynvjJBAh2vCS_umO_I5_b4EsN5l6KnApahCpoY2EM9zGhrJAWrB2rUarBlSPzZoK/exec";
  
  let allData = []; // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã“ã“ã«ä¿å­˜

  // 1. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
  fetch(API_URL)
    .then(response => response.json())
    .then(data => {
      allData = data; // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      filterData('today'); // æœ€åˆã¯ã€Œä»Šæ—¥ã€ã‚’è¡¨ç¤º
      
      document.getElementById('loading').style.display = 'none';
      document.getElementById('customerTable').style.display = 'table';
      
      // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ„ãƒ¼ãƒ«ã«ã‚»ãƒƒãƒˆã—ã¦ãŠã
      setTodayToTool();
    })
    .catch(error => {
      console.error(error);
      document.getElementById('loading').innerText = "èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼";
    });

  // 2. ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function renderTable(data) {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = ""; // ã‚¯ãƒªã‚¢

    if(data.length === 0) {
      tbody.innerHTML = "<tr><td colspan='5' style='text-align:center'>è©²å½“ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>";
      return;
    }

    data.forEach(row => {
        const dateStr = row[2]; // Cåˆ—
        const timeStr = row[3]; // Dåˆ—
        let name = row[12] || row[6] + " (LINE)"; // Måˆ—å„ªå…ˆ
        const staff = row[9];
        const status = row[5];

        const tr = document.createElement('tr');
        tr.className = "clickable";
        
        // è¡Œã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãƒ„ãƒ¼ãƒ«ã«å…¥åŠ›ã™ã‚‹è¨­å®š
        tr.onclick = function() {
            // è‰²ã‚’å¤‰ãˆã‚‹
            document.querySelectorAll('tr').forEach(t => t.classList.remove('selected'));
            tr.classList.add('selected');
            
            // ãƒ„ãƒ¼ãƒ«ã«å…¥åŠ›
            fillTool(dateStr, timeStr);
        };

        tr.innerHTML = `
          <td>${dateStr}</td>
          <td>${timeStr}</td>
          <td style="font-weight:bold">${name}</td>
          <td>${staff}</td>
          <td><span style="font-size:0.8em; padding:2px 6px; background:#eee; border-radius:4px;">${status}</span></td>
        `;
        tbody.appendChild(tr);
    });
  }

  // 3. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ (Aæ¡ˆ: ä»Šæ—¥ / å…¨ã¦)
  function filterData(type) {
    // ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®åˆ‡ã‚Šæ›¿ãˆ
    document.getElementById('btnToday').classList.remove('active');
    document.getElementById('btnAll').classList.remove('active');
    
    let filtered = [];
    const today = new Date();
    // YYYY.MM.DDå½¢å¼ã‚’ä½œã‚‹ (0åŸ‹ã‚å¯¾å¿œ)
    const y = today.getFullYear();
    const m = ('0' + (today.getMonth()+1)).slice(-2);
    const d = ('0' + today.getDate()).slice(-2);
    const todayStr = `${y}.${m}.${d}`; // 2026.01.14

    if (type === 'today') {
        document.getElementById('btnToday').classList.add('active');
        // æ—¥ä»˜æ–‡å­—åˆ—ã«ä»Šæ—¥ã®æ—¥ä»˜ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        filtered = allData.filter(row => {
            const rowDate = row[2]; // ä¾‹: 2026.01.14 (æ°´)
            return rowDate && rowDate.includes(todayStr);
        });
    } else {
        document.getElementById('btnAll').classList.add('active');
        filtered = allData;
    }
    renderTable(filtered);
  }

  // 4. æ¤œç´¢æ©Ÿèƒ½ (Bæ¡ˆ)
  function searchData() {
    const keyword = document.getElementById('searchInput').value.toLowerCase();
    const filtered = allData.filter(row => {
        const str = (row.join(" ")).toLowerCase(); // å…¨åˆ—ã®æ–‡å­—ã‚’ã¤ãªã’ã¦æ¤œç´¢
        return str.includes(keyword);
    });
    renderTable(filtered);
  }

  // 5. ãƒ„ãƒ¼ãƒ«ã¸ã®è‡ªå‹•å…¥åŠ›æ©Ÿèƒ½ (é€£æº)
  function fillTool(dateStr, timeStr) {
    // æ—¥ä»˜: 2026.01.14 (æ°´) -> 2026å¹´1æœˆ14æ—¥ (æ°´) ã«å¤‰æ›ã—ã¦å…¥ã‚ŒãŸã„
    // ãã®ã¾ã¾å…¥ã‚Œã‚‹
    document.getElementById('inputDate').value = dateStr.replace(/\./g, '/'); 
    
    // æ™‚é–“: "10:00" ã®å½¢ã«ã™ã‚‹
    if(timeStr) {
        // "10:00:00" ã¨ã‹ãªã‚‰çŸ­ãã™ã‚‹
        const shortTime = timeStr.toString().substr(0, 5); 
        document.getElementById('inputTime').value = shortTime;
    }
    
    updatePreview(); // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
    
    // ã‚¹ãƒãƒ›ãªã‚‰ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    if(window.innerWidth < 600) {
        document.getElementById('toolArea').scrollIntoView({behavior: "smooth"});
    }
  }

  // åˆæœŸè¨­å®šï¼šä»Šæ—¥ã®æ—¥ä»˜ã‚’å…¥ã‚Œã‚‹
  function setTodayToTool() {
    const d = new Date();
    const week = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
    const s = `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()} (${week[d.getDay()]})`;
    document.getElementById('inputDate').value = s;
    updatePreview();
  }

  // --- ä»¥ä¸‹ã€ä»¥å‰ã®ãƒ„ãƒ¼ãƒ«ã®ãƒ­ã‚¸ãƒƒã‚¯ ---

  function updatePreview() {
    const date = document.getElementById('inputDate').value;
    const time = document.getElementById('inputTime').value;
    const method = document.getElementById('inputMethod').value;
    
    const text = `ãƒ•ãƒ¤ã‚»ãƒ«ã‚µãƒãƒ¼ãƒˆã§ã™ã€‚
ã”é€£çµ¡ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

__________________________

é¢è«‡äºˆç´„æ—¥æ™‚
${date}
${time}ã€œé¢è«‡é–‹å§‹
æ–¹æ³•ï¼š${method}
__________________________

ã”æŒ‡å®šã®ãŠæ™‚é–“ã«`;

    document.getElementById('previewBox').value = text;
  }

  function copyFull() {
    const text = document.getElementById('previewBox').value;
    navigator.clipboard.writeText(text).then(() => {
      alert("âœ… å…¨æ–‡ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    });
  }

  function copyDateOnly() {
    const date = document.getElementById('inputDate').value;
    const time = document.getElementById('inputTime').value;
    const text = `${date} ${time}ã€œ`;
    navigator.clipboard.writeText(text).then(() => {
        alert("âœ… æ—¥æ™‚ã ã‘ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n" + text);
    });
  }

  // å…¥åŠ›ãŒå¤‰ã‚ã£ãŸã‚‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
  document.getElementById('inputDate').addEventListener('input', updatePreview);
  document.getElementById('inputTime').addEventListener('change', updatePreview);

</script>

</body>
</html>
