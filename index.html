<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ãƒ•ãƒ¤ã‚»ãƒ«äºˆç´„ç®¡ç†ï¼†ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    /* --- åŸºæœ¬è¨­å®šï¼ˆé ‚ã„ãŸã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ï¼‰ --- */
    * { box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans JP", sans-serif;
      background: #f5f7fb;
      padding: 20px;
    }

    /* --- ä¸Šéƒ¨ï¼šäºˆç´„ãƒªã‚¹ãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæ–°è¦è¿½åŠ ï¼‰ --- */
    .list-container {
      max-width: 800px; /* ãƒªã‚¹ãƒˆã¯å°‘ã—åºƒã‚ã« */
      margin: 0 auto 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 8px 20px rgba(0,0,0,.08);
    }
    .filter-area { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
    .filter-area input { margin-top: 0; } /* èª¿æ•´ */
    .btn-filter {
      padding: 8px 16px; border: none; border-radius: 8px; cursor: pointer;
      font-weight: bold; background: #e0e0e0; color: #555;
    }
    .btn-filter.active { background: #2563eb; color: #fff; }
    
    .table-wrapper { max-height: 250px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; white-space: nowrap; font-size: 13px; }
    th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
    th { background-color: #f8f9fa; position: sticky; top: 0; z-index: 1; }
    tr.clickable { cursor: pointer; transition: background 0.1s; }
    tr.clickable:hover { background-color: #e3f2fd; }
    tr.selected { background-color: #bbdefb; border-left: 5px solid #2563eb; }

    /* --- ä¸‹éƒ¨ï¼šç”Ÿæˆãƒ„ãƒ¼ãƒ«ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆé ‚ã„ãŸã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ï¼‰ --- */
    .box {
      max-width: 520px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 8px 20px rgba(0,0,0,.08);
    }

    h1 { font-size: 18px; margin: 0 0 16px; }
    h2 { font-size: 16px; margin: 0 0 10px; color: #555; border-bottom: 1px solid #eee; padding-bottom: 8px;}

    label { display: block; margin-top: 12px; font-size: 13px; color: #555; }

    input, select, button, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      font-size: 15px;
      border-radius: 10px;
      border: 1px solid #d7dbe6;
      background: #fff;
    }

    /* dateã®ã‚¢ã‚¤ã‚³ãƒ³å¯¾ç­– */
    .dateWrap { position: relative; }
    input[type="date"] { padding-right: 12px; }
    input[type="date"]::-webkit-calendar-picker-indicator {
      opacity: 0; position: absolute; right: 0; top: 0; width: 100%; height: 100%; cursor: pointer;
    }

    .btnRow { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 14px; }
    button { border: none; cursor: pointer; font-weight: 800; background: #2563eb; color: #fff; }
    button.secondary { background: #111827; }
    button:hover { opacity: .92; }
    .mini { margin-top: 10px; font-size: 12px; color: #667085; }
    
    textarea {
      height: 260px; margin-top: 12px; font-size: 14px; line-height: 1.6;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Noto Sans Mono", monospace;
      white-space: pre-wrap;
    }
    .status { margin-top: 8px; font-size: 12px; color: #0f766e; min-height: 16px; }

  </style>
</head>

<body>

  <div class="list-container">
    <h2>ğŸ“… äºˆç´„ãƒªã‚¹ãƒˆã‹ã‚‰é¸æŠ</h2>
    <div class="filter-area">
      <button class="btn-filter active" id="btnToday">ä»Šæ—¥ã®ã¿</button>
      <button class="btn-filter" id="btnAll">å…¨ã¦è¡¨ç¤º</button>
      <input type="text" id="searchInput" placeholder="åå‰æ¤œç´¢..." style="flex:1;">
    </div>
    
    <div id="loading" style="font-size:12px; color:#666;">èª­ã¿è¾¼ã¿ä¸­...</div>

    <div class="table-wrapper">
      <table id="customerTable" style="display:none;">
        <thead>
          <tr>
            <th>æ¥åº—æ—¥</th>
            <th>æ™‚é–“</th>
            <th>ãŠåå‰</th>
            <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          </tbody>
      </table>
    </div>
  </div>
  <div class="box" id="toolBox">
    <h1>ğŸ—“ é¢è«‡ãƒ¡ãƒ¢ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>

    <label>æ—¥ä»˜ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‰</label>
    <div class="dateWrap">
      <input type="date" id="date">
    </div>

    <label>é–‹å§‹æ™‚é–“ï¼ˆ10ã€œ17æ™‚ï¼‰</label>
    <select id="time"></select>

    <label>é¢è«‡æ–¹æ³•</label>
    <select id="method">
      <option>Google Meet</option>
      <option>é›»è©±</option>
      <option>LINE</option>
      <option>ãƒ¡ãƒ¼ãƒ«</option>
    </select>

    <div class="btnRow">
      <button id="copyAllBtn">å…¨æ–‡ã‚³ãƒ”ãƒ¼ï¼ˆé€ä¿¡ç”¨ï¼‰</button>
      <button class="secondary" id="copyDateBtn">æ—¥æ™‚ã ã‘ã‚³ãƒ”ãƒ¼</button>
    </div>

    <div class="status" id="status"></div>

    <div class="mini">ä¸‹ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ï¼ˆãã®ã¾ã¾è²¼ã‚Šä»˜ã‘OKï¼‰</div>
    <textarea id="preview" readonly></textarea>
  </div>

<script>
(() => {
  // --- 1. é ‚ã„ãŸãƒ„ãƒ¼ãƒ«ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãã®ã¾ã¾ï¼‰ ---
  const week = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
  const LINE = "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€";

  const dateEl = document.getElementById("date");
  const timeEl = document.getElementById("time");
  const methodEl = document.getElementById("method");
  const previewEl = document.getElementById("preview");
  const statusEl = document.getElementById("status");
  const copyAllBtn = document.getElementById("copyAllBtn");
  const copyDateBtn = document.getElementById("copyDateBtn");

  // æ™‚é–“ç”Ÿæˆï¼ˆâ€»ãƒªã‚¹ãƒˆã®22æ™‚ãªã©ã®äºˆç´„ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€è£å´ã§ã¯ç¯„å›²ã‚’åºƒã’ã¦ãŠãã¾ã—ãŸï¼‰
  function buildTimes() {
    timeEl.innerHTML = "";
    // ãƒ‡ãƒ¼ã‚¿ã«åˆã‚ã›ã¦ 5æ™‚ã€œ23æ™‚ ã¾ã§ç”Ÿæˆã—ã¦ãŠãã¾ã™ï¼ˆè¦‹ãŸç›®ã¯é ‚ã„ãŸã‚³ãƒ¼ãƒ‰ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã¾ã¾ï¼‰
    for (let h = 5; h <= 23; h++) {
      const opt = document.createElement("option");
      opt.value = String(h);
      opt.textContent = `${h}æ™‚ï½é¢è«‡é–‹å§‹`;
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠã‚’10æ™‚ã«ã—ã¦ãŠã
      if(h === 10) opt.selected = true;
      timeEl.appendChild(opt);
    }
  }

  function setToday() {
    const t = new Date();
    const yyyy = t.getFullYear();
    const mm = String(t.getMonth()+1).padStart(2,"0");
    const dd = String(t.getDate()).padStart(2,"0");
    dateEl.value = `${yyyy}-${mm}-${dd}`;
  }

  function fmtDateParts() {
    const v = dateEl.value;
    if (!v) return null;
    const d = new Date(v + "T00:00:00");
    const y = d.getFullYear();
    const m = d.getMonth() + 1;
    const day = d.getDate();
    const dow = week[d.getDay()];
    const h = Number(timeEl.value || 10);
    const method = methodEl.value;
    return { y, m, day, dow, h, method };
  }

  function buildDateBox() {
    const p = fmtDateParts();
    if (!p) return "";
    return `${LINE}
é¢è«‡äºˆç´„æ—¥æ™‚
${p.y}å¹´${p.m}æœˆ${p.day}æ—¥ï¼ˆ${p.dow}ï¼‰
${p.h}æ™‚ï½é¢è«‡é–‹å§‹
æ–¹æ³•ï¼š${p.method}
${LINE}`;
  }

  function buildFullMessage() {
    const p = fmtDateParts();
    if (!p) return "";
    const dateBox = buildDateBox();
    
    // â˜…é ‚ã„ãŸæ–‡é¢ãã®ã¾ã¾
    return `ãƒ•ãƒ¤ã‚»ãƒ«ã‚µãƒãƒ¼ãƒˆã§ã™ã€‚
ã”é€£çµ¡ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

${dateBox}

ã”æŒ‡å®šã®ãŠæ™‚é–“ã«
ç©ºãæ ãŒã”ã–ã„ã¾ã—ãŸã®ã§
ä¸Šè¨˜æ—¥ç¨‹ã«ã¦é¢è«‡ã«
å…¥ã‚‰ã›ã¦ã„ãŸã ãã¾ã™ã€‚

é¢è«‡ã®éš›ã«ã¯

ã€Œãƒ•ãƒ¤ã‚»ãƒ«AIã®æº–å‚™ã€
ã€ŒèããŸã„ã“ã¨ã€
ã€Œã‚µãƒãƒ¼ãƒˆã‚’å—ã‘ãŸã„ã“ã¨ã€

ã“ã¡ã‚‰ã‚’ã”ç”¨æ„ãƒ»ã”æº–å‚™ã®ã†ãˆ
ã”å‚åŠ ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

ãã®é–“ã§ã‚‚
ã”è³ªå•ãªã©ãŒã”ã–ã„ã¾ã—ãŸã‚‰

ã—ã£ã‹ã‚Šä¸å¯§ã«ã‚µãƒãƒ¼ãƒˆå¯¾å¿œã‚’
ã•ã›ã¦ã„ãŸã ãã¾ã™ã®ã§

ã”ä¸æ˜ç‚¹ãŒã”ã–ã„ã¾ã™å ´åˆã¯
ãŠå•ã„åˆã‚ã›ãã ã•ã„ã¾ã›ã€‚

ä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚`;
  }

  function renderPreview() {
    const text = buildFullMessage();
    previewEl.value = text || "æ—¥ä»˜ã‚’é¸ã¶ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå‡ºã¾ã™";
    statusEl.textContent = "";
  }

  async function copyText(text, okMsg) {
    if (!text) {
      statusEl.textContent = "æ—¥ä»˜ã‚’é¸ã‚“ã§ãã ã•ã„";
      statusEl.style.color = "#b45309";
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      statusEl.textContent = okMsg;
      statusEl.style.color = "#0f766e";
    } catch {
      previewEl.focus();
      previewEl.select();
      document.execCommand("copy");
      statusEl.textContent = okMsg + "ï¼ˆäº’æ›ã‚³ãƒ”ãƒ¼ï¼‰";
      statusEl.style.color = "#0f766e";
    }
    setTimeout(() => statusEl.textContent = "", 1500);
  }

  dateEl.addEventListener("change", renderPreview);
  timeEl.addEventListener("change", renderPreview);
  methodEl.addEventListener("change", renderPreview);

  copyAllBtn.addEventListener("click", () => copyText(buildFullMessage(), "å…¨æ–‡ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));
  copyDateBtn.addEventListener("click", () => copyText(buildDateBox(), "æ—¥æ™‚ã ã‘ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));

  buildTimes();
  setToday();
  renderPreview();


  // --- 2. äºˆç´„ãƒªã‚¹ãƒˆé€£æºæ©Ÿèƒ½ï¼ˆæ–°è¦è¿½åŠ ï¼‰ ---
  const API_URL = "https://script.google.com/macros/s/AKfycbzUynvjJBAh2vCS_umO_I5_b4EsN5l6KnApahCpoY2EM9zGhrJAWrB2rUarBlSPzZoK/exec";
  let allData = [];

  // ãƒ‡ãƒ¼ã‚¿å–å¾—
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      allData = data;
      filterList('today'); // åˆæœŸè¡¨ç¤º
      document.getElementById('loading').style.display = 'none';
      document.getElementById('customerTable').style.display = 'table';
    })
    .catch(err => console.error(err));

  // ãƒªã‚¹ãƒˆæç”»
  function renderList(data) {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = "";
    if(data.length === 0) {
      tbody.innerHTML = "<tr><td colspan='4' style='text-align:center; color:#999;'>è©²å½“ãªã—</td></tr>";
      return;
    }
    data.forEach(row => {
      // åˆ—: C=2(æ—¥), D=3(æ™‚), M=12(å), F=5(ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹)
      const dStr = row[2];
      const tStr = row[3];
      const name = row[12] || row[6] || "åç§°ãªã—";
      const status = row[5];

      const tr = document.createElement('tr');
      tr.className = "clickable";
      tr.innerHTML = `<td>${dStr}</td><td>${tStr}</td><td style="font-weight:bold">${name}</td><td>${status}</td>`;
      
      // â˜…ã‚¯ãƒªãƒƒã‚¯æ™‚ã®é€£æºå‡¦ç†
      tr.onclick = () => {
        // è‰²å¤‰ãˆ
        document.querySelectorAll('tr').forEach(t => t.classList.remove('selected'));
        tr.classList.add('selected');

        // æ—¥ä»˜å…¥åŠ› (YYYY.MM.DD -> YYYY-MM-DD)
        if(dStr) {
           const cleanDate = dStr.replace(/\./g, '-').split(' ')[0]; // (æ°´)ãªã©ã‚’é™¤å»
           dateEl.value = cleanDate;
        }
        // æ™‚é–“å…¥åŠ› (10:00 -> 10)
        if(tStr) {
           const hour = parseInt(tStr);
           if(hour) timeEl.value = String(hour);
        }
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
        renderPreview();
        
        // ã‚¹ãƒãƒ›ãªã‚‰ä¸‹ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        if(window.innerWidth < 600) {
            document.getElementById('toolBox').scrollIntoView({behavior: "smooth"});
        }
      };
      tbody.appendChild(tr);
    });
  }

  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  function filterList(type) {
    const btnToday = document.getElementById('btnToday');
    const btnAll = document.getElementById('btnAll');
    
    const today = new Date();
    const y = today.getFullYear();
    const m = ('0' + (today.getMonth()+1)).slice(-2);
    const d = ('0' + today.getDate()).slice(-2);
    const todayStr = `${y}.${m}.${d}`; // ã‚¹ãƒ—ã‚·å½¢å¼ã«åˆã‚ã›ã‚‹

    if(type === 'today') {
      btnToday.classList.add('active');
      btnAll.classList.remove('active');
      renderList(allData.filter(row => row[2] && row[2].includes(todayStr)));
    } else {
      btnAll.classList.add('active');
      btnToday.classList.remove('active');
      renderList(allData);
    }
  }
  
  // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  document.getElementById('btnToday').onclick = () => filterList('today');
  document.getElementById('btnAll').onclick = () => filterList('all');
  document.getElementById('searchInput').onkeyup = (e) => {
    const val = e.target.value.toLowerCase();
    renderList(allData.filter(row => row.join(" ").toLowerCase().includes(val)));
  };

})();
</script>
</body>
</html>
