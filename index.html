<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ãƒ•ãƒ¤ã‚»ãƒ«é¡§å®¢ç®¡ç†ï¼†ä½œæˆãƒ„ãƒ¼ãƒ«</title>
<style>
  /* --- ãƒ™ãƒ¼ã‚¹è¨­å®š --- */
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background-color: #f5f7fb;
    color: #333;
    padding: 20px;
    margin: 0;
  }
  .container { max-width: 1000px; margin: 0 auto; }

  /* ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
  .card {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    margin-bottom: 20px;
  }

  h2 { margin-top: 0; font-size: 18px; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; }

  /* --- ãƒªã‚¹ãƒˆãƒ»æ¤œç´¢ã‚¨ãƒªã‚¢ --- */
  .filter-area { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
  input[type="text"] { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
  .btn-filter {
    padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;
    font-weight: bold; background: #e0e0e0; color: #555;
  }
  .btn-filter.active { background: #1565c0; color: #fff; }

  .table-wrapper { max-height: 300px; overflow-y: auto; border: 1px solid #eee; }
  table { width: 100%; border-collapse: collapse; white-space: nowrap; }
  th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; font-size: 14px; }
  th { background-color: #f8f9fa; position: sticky; top: 0; }
  tr.clickable { cursor: pointer; transition: background 0.2s; }
  tr.clickable:hover { background-color: #e3f2fd; }
  tr.selected { background-color: #bbdefb; border-left: 5px solid #1976d2; }

  /* --- ãƒ„ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ï¼ˆå¾©æ´»ï¼†ä¿®æ­£ç‰ˆï¼‰ --- */
  label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; color: #555; }
  
  /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
  .input-group { margin-top: 5px; }
  input, select, textarea {
    width: 100%; padding: 12px;
    border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box;
    background: #fafafa;
  }
  input:focus, select:focus, textarea:focus {
    border-color: #2563eb; background: #fff; outline: none;
  }

  /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
  .btn-area { display: flex; gap: 10px; margin-top: 20px; }
  .btn-copy {
    flex: 1; padding: 14px; border: none; border-radius: 8px;
    color: #fff; font-weight: bold; cursor: pointer; font-size: 16px;
    transition: transform 0.1s;
  }
  .btn-blue { background-color: #2563eb; } /* å…¨æ–‡ã‚³ãƒ”ãƒ¼ç”¨ */
  .btn-dark { background-color: #1e293b; } /* æ—¥æ™‚ã ã‘ã‚³ãƒ”ãƒ¼ç”¨ */
  .btn-copy:active { opacity: 0.8; transform: translateY(2px); }

  /* ã‚¹ãƒãƒ›å¯¾å¿œ */
  @media (max-width: 600px) {
    .filter-area, .btn-area { flex-direction: column; }
  }
</style>
</head>
<body>

<div class="container">

  <div class="card">
    <div class="filter-area">
      <button class="btn-filter active" id="btnToday" onclick="filterData('today')">ä»Šæ—¥ã®ã¿</button>
      <button class="btn-filter" id="btnAll" onclick="filterData('all')">å…¨ã¦è¡¨ç¤º</button>
      <input type="text" id="searchInput" placeholder="åå‰ã§æ¤œç´¢..." onkeyup="searchData()">
    </div>
    
    <div id="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...<br><small>ï¼ˆãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã«å…¥åŠ›ã•ã‚Œã¾ã™ï¼‰</small></div>
    
    <div class="table-wrapper">
      <table id="customerTable" style="display:none;">
        <thead>
          <tr>
            <th>æ¥åº—æ—¥</th>
            <th>æ™‚é–“</th>
            <th>ãŠåå‰</th>
            <th>æ‹…å½“</th>
            <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          </tbody>
      </table>
    </div>
  </div>

  <div class="card" id="toolArea">
    <h2>ğŸ“ é¢è«‡ãƒ¡ãƒ¢ãƒ»ãƒ¡ãƒ¼ãƒ«ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h2>
    
    <label>æ—¥ä»˜</label>
    <input type="text" id="inputDate" placeholder="ä¾‹: 2026å¹´1æœˆ14æ—¥ (æ°´)">
    
    <label>é–‹å§‹æ™‚é–“ï¼ˆï½ä»˜ãï¼‰</label>
    <select id="inputTime" onchange="updatePreview()">
      <option value="10æ™‚ï½é¢è«‡é–‹å§‹">10æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="11æ™‚ï½é¢è«‡é–‹å§‹">11æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="12æ™‚ï½é¢è«‡é–‹å§‹">12æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="13æ™‚ï½é¢è«‡é–‹å§‹">13æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="14æ™‚ï½é¢è«‡é–‹å§‹">14æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="15æ™‚ï½é¢è«‡é–‹å§‹">15æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="16æ™‚ï½é¢è«‡é–‹å§‹">16æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="17æ™‚ï½é¢è«‡é–‹å§‹">17æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="18æ™‚ï½é¢è«‡é–‹å§‹">18æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="19æ™‚ï½é¢è«‡é–‹å§‹">19æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="20æ™‚ï½é¢è«‡é–‹å§‹">20æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="21æ™‚ï½é¢è«‡é–‹å§‹">21æ™‚ï½é¢è«‡é–‹å§‹</option>
      <option value="22æ™‚ï½é¢è«‡é–‹å§‹">22æ™‚ï½é¢è«‡é–‹å§‹</option>
    </select>
    
    <label>é¢è«‡æ–¹æ³•</label>
    <select id="inputMethod" onchange="updatePreview()">
      <option value="Google Meet">Google Meet</option>
      <option value="Zoom">Zoom</option>
      <option value="é›»è©±">é›»è©±</option>
      <option value="ãƒ¡ãƒ¼ãƒ«">ãƒ¡ãƒ¼ãƒ«</option>
    </select>

    <div class="btn-area">
      <button class="btn-copy btn-blue" onclick="copyFull()">å…¨æ–‡ã‚³ãƒ”ãƒ¼ (é€ä¿¡ç”¨)</button>
      <button class="btn-copy btn-dark" onclick="copyDateOnly()">æ—¥æ™‚ã ã‘ã‚³ãƒ”ãƒ¼</button>
    </div>

    <label>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (è‡ªå‹•æ›´æ–°)</label>
    <textarea id="previewBox" rows="10" readonly></textarea>
  </div>

</div>

<script>
  // â˜…Apps Scriptã®URLï¼ˆå¤‰æ›´ãªã—ï¼‰
  const API_URL = "https://script.google.com/macros/s/AKfycbzUynvjJBAh2vCS_umO_I5_b4EsN5l6KnApahCpoY2EM9zGhrJAWrB2rUarBlSPzZoK/exec";
  
  let allData = [];

  // --- 1. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¨ãƒªã‚¹ãƒˆè¡¨ç¤º ---
  fetch(API_URL)
    .then(response => response.json())
    .then(data => {
      allData = data;
      filterData('today'); // åˆæœŸè¡¨ç¤ºã¯ä»Šæ—¥ã®ã¿
      document.getElementById('loading').style.display = 'none';
      document.getElementById('customerTable').style.display = 'table';
      setTodayToTool(); // ãƒ„ãƒ¼ãƒ«ã®æ—¥ä»˜ã‚’ä»Šæ—¥ã«ã™ã‚‹
    })
    .catch(error => {
      console.error(error);
      document.getElementById('loading').innerText = "èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼";
    });

  // ãƒªã‚¹ãƒˆç”Ÿæˆ
  function renderTable(data) {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = "";

    if(data.length === 0) {
      tbody.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px;'>è©²å½“ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>";
      return;
    }

    data.forEach(row => {
        const dateStr = row[2];
        const timeStr = row[3];
        let name = row[12] || row[6] + " (LINE)";
        const staff = row[9];
        const status = row[5];

        const tr = document.createElement('tr');
        tr.className = "clickable";
        
        // â˜…ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‹•ä½œï¼šä¸‹ã®ãƒ„ãƒ¼ãƒ«ã«å…¥åŠ›ã™ã‚‹
        tr.onclick = function() {
            document.querySelectorAll('tr').forEach(t => t.classList.remove('selected'));
            tr.classList.add('selected');
            fillTool(dateStr, timeStr);
        };

        tr.innerHTML = `<td>${dateStr}</td><td>${timeStr}</td><td style="font-weight:bold">${name}</td><td>${staff}</td><td>${status}</td>`;
        tbody.appendChild(tr);
    });
  }

  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
  function filterData(type) {
    document.getElementById('btnToday').classList.remove('active');
    document.getElementById('btnAll').classList.remove('active');
    
    let filtered = [];
    const today = new Date();
    const y = today.getFullYear();
    const m = ('0' + (today.getMonth()+1)).slice(-2);
    const d = ('0' + today.getDate()).slice(-2);
    const todayStr = `${y}.${m}.${d}`; // 2026.01.14

    if (type === 'today') {
        document.getElementById('btnToday').classList.add('active');
        filtered = allData.filter(row => row[2] && row[2].includes(todayStr));
    } else {
        document.getElementById('btnAll').classList.add('active');
        filtered = allData;
    }
    renderTable(filtered);
  }

  // æ¤œç´¢æ©Ÿèƒ½
  function searchData() {
    const keyword = document.getElementById('searchInput').value.toLowerCase();
    renderTable(allData.filter(row => row.join(" ").toLowerCase().includes(keyword)));
  }

  // --- 2. ãƒ„ãƒ¼ãƒ«é€£æºæ©Ÿèƒ½ï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰ ---

  // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã«ã€ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹æ©Ÿèƒ½
  function fillTool(dateStr, timeStr) {
    // æ—¥ä»˜ã‚’å¤‰æ›: 2026.01.14 (æ°´) -> 2026å¹´1æœˆ14æ—¥ (æ°´) â€»/ã§ã‚‚.ã§ã‚‚å¯¾å¿œ
    let cleanDate = dateStr.replace(/\./g, '/');
    // ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’å¹´æœˆã«å¤‰ãˆã‚‹ç°¡æ˜“å‡¦ç†ï¼ˆç°¡æ˜“çš„ã«ç½®æ›ï¼‰
    cleanDate = cleanDate.replace(/(\d{4})\/(\d{1,2})\/(\d{1,2})/, '$1å¹´$2æœˆ$3æ—¥');
    document.getElementById('inputDate').value = cleanDate;
    
    // æ™‚é–“ã‚’å¤‰æ›: 10:00 -> 10æ™‚ï½é¢è«‡é–‹å§‹ ã«ãƒãƒƒãƒã•ã›ã‚‹
    if(timeStr) {
        // å…ˆé ­ã®æ•°å­—ï¼ˆ10ãªã©ï¼‰ã‚’å–ã‚Šå‡ºã™
        const hour = parseInt(timeStr); 
        if(hour) {
            // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®å€¤ã‚’ã‚»ãƒƒãƒˆ
            document.getElementById('inputTime').value = `${hour}æ™‚ï½é¢è«‡é–‹å§‹`;
        }
    }
    
    updatePreview();
    
    // ã‚¹ãƒãƒ›ã®å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    if(window.innerWidth < 600) {
        document.getElementById('toolArea').scrollIntoView({behavior: "smooth"});
    }
  }

  function setTodayToTool() {
    const d = new Date();
    const week = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
    const s = `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥ (${week[d.getDay()]})`;
    document.getElementById('inputDate').value = s;
    updatePreview();
  }

  // --- 3. ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ï¼ˆè¦æœ›é€šã‚Šå¾©æ´»ï¼‰ ---

  function updatePreview() {
    const date = document.getElementById('inputDate').value;
    const time = document.getElementById('inputTime').value; // ã€Œ10æ™‚ï½é¢è«‡é–‹å§‹ã€ãŒå…¥ã‚‹
    const method = document.getElementById('inputMethod').value;
    
    const text = `ãƒ•ãƒ¤ã‚»ãƒ«ã‚µãƒãƒ¼ãƒˆã§ã™ã€‚
ã”é€£çµ¡ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

__________________________

é¢è«‡äºˆç´„æ—¥æ™‚
${date}
${time}
æ–¹æ³•ï¼š${method}
__________________________

ã”æŒ‡å®šã®ãŠæ™‚é–“ã«`;

    document.getElementById('previewBox').value = text;
  }

  function copyFull() {
    const text = document.getElementById('previewBox').value;
    navigator.clipboard.writeText(text).then(() => {
      alert("âœ… å…¨æ–‡ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    });
  }

  // â˜…ä¿®æ­£ï¼šæ—¥æ™‚ã ã‘ã‚³ãƒ”ãƒ¼ã‚’ã‚‚ã£ã¨ã€Œæ¿ƒãã€ã—ã¾ã—ãŸ
  function copyDateOnly() {
    const date = document.getElementById('inputDate').value;
    const time = document.getElementById('inputTime').value;
    const method = document.getElementById('inputMethod').value;
    
    // è¦æœ›ï¼šã€Œå†…å®¹ã‚‚ã‚‚ã£ã¨æ¿ƒã‹ã£ãŸã¯ãšã€
    // â†’ é¢è«‡äºˆç´„æ—¥æ™‚ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã€æ–¹æ³•ã¾ã§å«ã‚ãŸãƒ–ãƒ­ãƒƒã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™
    const richText = `é¢è«‡äºˆç´„æ—¥æ™‚
${date}
${time}
æ–¹æ³•ï¼š${method}`;

    navigator.clipboard.writeText(richText).then(() => {
        alert("âœ… æ—¥æ™‚æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n\n" + richText);
    });
  }

  // å…¥åŠ›ãŒå¤‰ã‚ã£ãŸã‚‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
  document.getElementById('inputDate').addEventListener('input', updatePreview);

</script>

</body>
</html>
